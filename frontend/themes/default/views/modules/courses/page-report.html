<breadcrumbs>
    <crumb href="'/'" title="'Мой кабинет'|translate" />
    <crumb href="'/study-resources'" title="'Учебные ресурсы'|translate" />
    <crumb href="'/courses'" title="'Курсы'|translate"/>
    <crumb href="'/courses/' + course.id + '/view'" title="course.title"/>
    <crumb title="'Отчет'|translate"/>
</breadcrumbs>


<div class="padded">
    <div class="page-header">
        <div class="table-actions">
            <a class="btn btn-primary" ng-mousedown="csv.generate()" ng-href="{{ csv.link() }}" download="report.csv">{{'Выгрузить в CSV'|translate}}</a>
        </div>

        <h1>{{'Отчет по курсу'|translate}}</h1>
        <h6><strong>{{'Курс'|translate}}:</strong> {{course.title}}</h6>
    </div>

    <div class="main-content" bz-loading-container="loading" class="course-report">
        <table ng-table="tableParams" class="table table-striped table-condensed table-hover table-courses" show-filter="true" export-csv="csv">
            <thead>
                <tr>
                    <th class="text-center sortable" ng-class="{
                        'sort-asc': tableParams.isSortBy('user_full_name', 'asc'),
                        'sort-desc': tableParams.isSortBy('user_full_name', 'desc')
                    }" ng-click="tableParams.sorting('user_full_name', tableParams.isSortBy('user_full_name', 'asc') ? 'desc' : 'asc')">
                        {{'ФИО'|translate}}
                    </th>
                    <th class="text-center sortable" ng-class="{
                        'sort-asc': tableParams.isSortBy('task_start_date', 'asc'),
                        'sort-desc': tableParams.isSortBy('task_start_date', 'desc')
                    }" ng-click="tableParams.sorting('task_start_date', tableParams.isSortBy('task_start_date', 'asc') ? 'desc' : 'asc')">
                        {{'Дата начала прохождения задания-курс'|translate}}
                    </th>
                    <th class="text-center sortable" ng-class="{
                        'sort-asc': tableParams.isSortBy('task_finish_date', 'asc'),
                        'sort-desc': tableParams.isSortBy('task_finish_date', 'desc')
                    }" ng-click="tableParams.sorting('task_finish_date', tableParams.isSortBy('task_finish_date', 'asc') ? 'desc' : 'asc')">
                        {{'Дата завершения задания-курса'|translate}}
                    </th>
                    <th class="text-center sortable" ng-class="{
                        'sort-asc': tableParams.isSortBy('task_status', 'asc'),
                        'sort-desc': tableParams.isSortBy('task_status', 'desc')
                    }" ng-click="tableParams.sorting('task_status', tableParams.isSortBy('task_status', 'asc') ? 'desc' : 'asc')">
                        {{'Текущий статус задания-курса'|translate}}
                    </th>
                    <th class="text-center sortable" ng-repeat="planItem in planItems" ng-class="{
                        'sort-asc': tableParams.isSortBy(planItem.id, 'asc'),
                        'sort-desc': tableParams.isSortBy(planItem.id, 'desc')
                    }" ng-click="tableParams.sorting(planItem.id, tableParams.isSortBy(planItem.id, 'asc') ? 'desc' : 'asc')">
                        {{planItem.title}}
                    </th>
                    <th class="text-center sortable">
                        {{'Итоговый результат'|translate}}
                    </th>
                </tr>
                <tr class="ng-table-filters" ng-show="show_filter">
                    <th class="filter">
                        <div>
                            <input type="text" class="input-filter form-control" ng-model="params.filter()['user_full_name']">
                        </div>
                    </th>
                    <th>
                        <div>
                            <input class="form-control" ng-model="params.filter().task_start_date" format="YYYY-MM-DD" separator=" - " date-range-picker>
                        </div>
                    </th>
                    <th>
                        <div>
                            <input class="form-control" ng-model="params.filter().task_finish_date" format="YYYY-MM-DD" separator=" - " date-range-picker>
                        </div>
                    </th>
                    <th class="filter">
                        <div>
                            <select class="filter filter-select form-control" ng-model="params.filter().task_status">
                                <option value=""> - </option>
                                <option ng-selected="params.filter().task_status == 'started'" value="started">{{'Начато'|translate}}</option>
                                <option ng-selected="params.filter().task_status == 'inprogress'" value="inprogress">{{'В процессе'|translate}}</option>
                                <option ng-selected="params.filter().task_status == 'finished'" value="finished">{{'Выполненно'|translate}}</option>
                            </select>
                        </div>
                    </th>
                    <th ng-repeat="planItem in planItems">
                    </th>
                    <th>
                        <div ng-include="'/themes/default/views/block/ng-table/filters/clear.html'"></div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="(k,reportItem) in reportItems">
                    <td filter="{ 'user_full_name': 'text' }">
                        {{reportItem.user_full_name}}
                    </td>
                    <td>
                        {{reportItem.task_start_date}}
                    </td>
                    <td>
                        {{reportItem.task_finish_date}}
                    </td>
                    <td>
                        <span ng-if="!reportItem.task_status">{{'Не начато'|translate}}</span>
                        <span ng-if="reportItem.task_status == 'started' ">{{'Начато'|translate}}</span>
                        <span ng-if="reportItem.task_status == 'inprogress' ">{{'В процессе'|translate}}</span>
                        <span ng-if="reportItem.task_status == 'finished' ">{{'Выполненно'|translate}}</span>
                    </td>

                    <td ng-repeat="planItem in planItems">
                        {{reportItem[planItem.id]}}
                    </td>
                    <td>
                        {{reportItem.task_mark}}
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>


